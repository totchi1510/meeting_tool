version: "3.9"
services:
  db:
    image: postgres:15-alpine
    container_name: meeting-tools-db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: meeting
    ports:
      - "5432:5432"
    volumes:
      - dbdata:/var/lib/postgresql/data

  app:
    build: .
    container_name: meeting-tools-app
    depends_on:
      - db
    ports:
      - "3000:3000"
    env_file:
      - .env
    environment:
      # Point to local Postgres (can be overridden by .env)
      DATABASE_URL: ${DATABASE_URL:-postgres://postgres:postgres@db:5432/meeting}
      NODE_ENV: production
      APP_TIMEZONE: Asia/Tokyo
      # Provide Slack tokens via your local .env (optional for /healthz only)
      # SLACK_SIGNING_SECRET, SLACK_BOT_TOKEN, SLACK_APP_TOKEN,
      # PUBLIC_BASE_URL, ENABLE_GCAL_OAUTH, GOOGLE_OAUTH_CLIENT_ID,
      # GOOGLE_OAUTH_CLIENT_SECRET, OAUTH_REDIRECT_BASE_URL, GCALENDAR_ID_SHARED
      # will be read from .env via env_file

volumes:
  dbdata:
